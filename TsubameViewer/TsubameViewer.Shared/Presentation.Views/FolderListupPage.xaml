<Page
    x:Class="TsubameViewer.Presentation.Views.FolderListupPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:TsubameViewer.Presentation.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ts="using:TsubameViewer.Presentation.Views.TemplateSelector" 
  xmlns:uwpControls="using:Microsoft.Toolkit.Uwp.UI.Controls" 
  xmlns:i="using:Microsoft.Xaml.Interactivity" 
  xmlns:core="using:Microsoft.Xaml.Interactions.Core" 
  xmlns:myBehaior="using:TsubameViewer.Presentation.Views.Behaviors" 
  xmlns:wst="using:WindowsStateTriggers" 
  xmlns:ss="using:TsubameViewer.Presentation.Views.StyleSelector" 
  xmlns:myConv="using:TsubameViewer.Presentation.Views.Converters"
  xmlns:models ="using:TsubameViewer.Models.Domain.FolderItemListing"
  mc:Ignorable="d"
  NavigationCacheMode="Enabled"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

  <Page.Resources>

    <x:Double x:Key="SmallImageWidth">96</x:Double>
    <x:Double x:Key="SmallImageHeight">96</x:Double>

    <x:Double x:Key="MidiumImageWidth">180</x:Double>
    <x:Double x:Key="MidiumImageHeight">180</x:Double>

    <x:Double x:Key="LargeImageWidth">300</x:Double>
    <x:Double x:Key="LargeImageHeight">426</x:Double>



    <ts:FolderItemTemplateSelector x:Key="FileItemTemplateSelector">
      <ts:FolderItemTemplateSelector.Image>
        <DataTemplate>
          <uwpControls:DockPanel>
            <Border uwpControls:DockPanel.Dock="Left" Margin="0 0 12 0">
              <SymbolIcon Symbol="Pictures" />
            </Border>
            <Border uwpControls:DockPanel.Dock="Bottom">
              <TextBlock Text="{Binding Path}" FontSize="12" Opacity="0.6" />
            </Border>
            <TextBlock Text="{Binding Name}" />
          </uwpControls:DockPanel>
          
        </DataTemplate>
      </ts:FolderItemTemplateSelector.Image>
      <ts:FolderItemTemplateSelector.Archive>
        <DataTemplate>
          <uwpControls:DockPanel>
            <Border uwpControls:DockPanel.Dock="Left" Margin="0 0 12 0">
              <SymbolIcon Symbol="Library" />
            </Border>
            <Border uwpControls:DockPanel.Dock="Bottom">
              <TextBlock Text="{Binding Path}" FontSize="12" Opacity="0.7" />
            </Border>
            <TextBlock Text="{Binding Name}" />
          </uwpControls:DockPanel>
        </DataTemplate>
      </ts:FolderItemTemplateSelector.Archive>
    </ts:FolderItemTemplateSelector>

    <ts:FolderItemTemplateSelector x:Key="SmallThumbnailFileItemTemplateSelector">
      <ts:FolderItemTemplateSelector.Image>
        <DataTemplate>
          <uwpControls:DockPanel>
            <Image Source="{Binding Image}" Width="{StaticResource SmallImageWidth}" Height="{StaticResource SmallImageHeight}" />
          </uwpControls:DockPanel>

        </DataTemplate>
      </ts:FolderItemTemplateSelector.Image>
      <ts:FolderItemTemplateSelector.Archive>
        <DataTemplate>
          <uwpControls:DockPanel>
            <TextBlock Text="{Binding Name}" uwpControls:DockPanel.Dock="Bottom" />
            <Image Source="{Binding Image}" Width="{StaticResource SmallImageWidth}" Height="{StaticResource SmallImageHeight}" />
          </uwpControls:DockPanel>
        </DataTemplate>
      </ts:FolderItemTemplateSelector.Archive>
    </ts:FolderItemTemplateSelector>

    <ts:FolderItemTemplateSelector x:Key="MidiumThumbnailFileItemTemplateSelector">
      <ts:FolderItemTemplateSelector.Image>
        <DataTemplate>
          <uwpControls:DockPanel>
            <Image Source="{Binding Image}" Width="{StaticResource MidiumImageWidth}" Height="{StaticResource MidiumImageHeight}" />
          </uwpControls:DockPanel>

        </DataTemplate>
      </ts:FolderItemTemplateSelector.Image>
      <ts:FolderItemTemplateSelector.Archive>
        <DataTemplate>
          <uwpControls:DockPanel>
            <TextBlock Text="{Binding Name}" uwpControls:DockPanel.Dock="Bottom" />
            <Image Source="{Binding Image}" Width="{StaticResource MidiumImageWidth}" Height="{StaticResource MidiumImageHeight}" />
          </uwpControls:DockPanel>
        </DataTemplate>
      </ts:FolderItemTemplateSelector.Archive>
    </ts:FolderItemTemplateSelector>

    <ts:FolderItemTemplateSelector x:Key="LargeThumbnailFileItemTemplateSelector">
      <ts:FolderItemTemplateSelector.Image>
        <DataTemplate>
          <uwpControls:DockPanel>
            <Image Source="{Binding Image}" Width="{StaticResource LargeImageWidth}" Height="{StaticResource LargeImageHeight}" />
          </uwpControls:DockPanel>

        </DataTemplate>
      </ts:FolderItemTemplateSelector.Image>
      <ts:FolderItemTemplateSelector.Archive>
        <DataTemplate>
          <uwpControls:DockPanel>
            <TextBlock Text="{Binding Name}" uwpControls:DockPanel.Dock="Bottom" />
            <Image Source="{Binding Image}" Width="{StaticResource LargeImageWidth}" Height="{StaticResource LargeImageHeight}" />
          </uwpControls:DockPanel>
        </DataTemplate>
      </ts:FolderItemTemplateSelector.Archive>
    </ts:FolderItemTemplateSelector>


    <ts:FileDisplayModeTemplateSelector x:Key="FileDisplayModeTemplateSelector">
      <ts:FileDisplayModeTemplateSelector.Line>
        <DataTemplate >
          <StackPanel Spacing="2">
            <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="5" Width="13"
                  />
            <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="5" Width="13"
                  />
          </StackPanel>
        </DataTemplate>
      </ts:FileDisplayModeTemplateSelector.Line>
      <ts:FileDisplayModeTemplateSelector.Small>
        <DataTemplate >
          <Grid>
            <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="13" Width="13"
                  />
            <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="13" Width="5"
                    Canvas.Left="2"
                    
                  />
            <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="5" Width="13"
                    Canvas.Top="2"
                  />

          </Grid>
        </DataTemplate>
      </ts:FileDisplayModeTemplateSelector.Small>
      <ts:FileDisplayModeTemplateSelector.Midium>
        <DataTemplate >
          <Grid>
            <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="13" Width="13"
                  />
            <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="7" Width="7"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                  />
            <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="7" Width="7"
                  HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                  />
          </Grid>
        </DataTemplate>
      </ts:FileDisplayModeTemplateSelector.Midium>
      <ts:FileDisplayModeTemplateSelector.Large>
        <DataTemplate >
          <Border BorderBrush="{ThemeResource ApplicationForegroundThemeBrush}" BorderThickness="1" 
                  Height="13" Width="13"
                  />
        </DataTemplate>
      </ts:FileDisplayModeTemplateSelector.Large>
    </ts:FileDisplayModeTemplateSelector>

  </Page.Resources>
  <Grid>
    <uwpControls:DockPanel>

      <StackPanel uwpControls:DockPanel.Dock="Top" x:Name="HeaderLayout" Margin="48 8">
        <ListView HorizontalAlignment="Right"
                  ItemsSource="{Binding FileDisplayModeItems}"
                  SelectedItem="{Binding FileDisplayMode.Value, Mode=TwoWay}"
                  ItemTemplateSelector="{StaticResource FileDisplayModeTemplateSelector}"
                  Visibility="Visible"
                  SelectionMode="Single"
                  SingleSelectionFollowsFocus="False"
                    >
          <ListView.ItemContainerStyle>
            <Style TargetType="ListViewItem">
              <Setter Property="MinWidth" Value="32" />
            </Style>
          </ListView.ItemContainerStyle>
          <ListView.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal" />
            </ItemsPanelTemplate>
          </ListView.ItemsPanel>
        </ListView>

        <TextBlock Text="{Binding DisplayCurrentPath}" Opacity="0.7" />
        <HyperlinkButton Content="元のフォルダへ戻る" Command="{Binding OpenPageCommand}" CommandParameter="{Binding FoldersManagementPageName}">
          
        </HyperlinkButton>

        
      </StackPanel>

      <!-- Files -->
      <uwpControls:AdaptiveGridView 
            x:Name="FilesListView"
            ItemsSource="{Binding FileItems}"
            ItemTemplateSelector="{StaticResource FileItemTemplateSelector}"
            Padding="48 8"
            IsItemClickEnabled="True"
            DesiredWidth="320"            
            ItemHeight="40"
            ItemClickCommand="{Binding OpenFolderItemCommand}"
            >

        <GridView.Header>
          <StackPanel>
            <uwpControls:AdaptiveGridView 
                    x:Name="FoldersAdaptiveGridView"
                    StretchContentForSingleRow="False"
                    OneRowModeEnabled="False"
                    ItemsSource="{Binding FolderItems}" 
                    ItemTemplateSelector="{StaticResource FolderItemTemplateSelector}"  
                  ItemContainerStyleSelector="{StaticResource FolderItemStyleSelector}"
                    DesiredWidth="360"            
                    ItemHeight="132"
                    IsItemClickEnabled="True"
                    ItemClickCommand="{Binding OpenFolderItemCommand}"
                    IsSynchronizedWithCurrentItem="False"
                    >
              <GridView.Header>
                <Grid >
                </Grid>

              </GridView.Header>
              <i:Interaction.Behaviors>
                <myBehaior:ListViewBaseFirstAppearTriggerBehavior>
                  <core:CallMethodAction MethodName="Initialize" />
                </myBehaior:ListViewBaseFirstAppearTriggerBehavior>
              </i:Interaction.Behaviors>
            </uwpControls:AdaptiveGridView>
          </StackPanel>
        </GridView.Header>

        <i:Interaction.Behaviors>
          <myBehaior:ListViewBaseFirstAppearTriggerBehavior x:Name="FirstAppearBehavior">
            <core:CallMethodAction MethodName="Initialize" />
          </myBehaior:ListViewBaseFirstAppearTriggerBehavior>

          <core:DataTriggerBehavior Binding="{Binding FileDisplayMode.Value}" Value="{x:Null}" ComparisonCondition="NotEqual">
            <core:CallMethodAction TargetObject="{x:Bind FirstAppearBehavior}" MethodName="Clear" />
          </core:DataTriggerBehavior>

        </i:Interaction.Behaviors>
      </uwpControls:AdaptiveGridView>

    </uwpControls:DockPanel>
    
    

    <VisualStateManager.VisualStateGroups>
      
      <!-- フォルダアイテムが無い時のフォルダリストの非表示切り替え -->
      <VisualStateGroup>
        <VisualState>
          <VisualState.StateTriggers>
            <wst:EqualsStateTrigger Value="{Binding FolderItems.Count}" EqualTo="0" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="FoldersAdaptiveGridView.Visibility" Value="Collapsed" />
          </VisualState.Setters>
        </VisualState>
      </VisualStateGroup>
      
      <!-- 画面サイズによる表示切り替え -->
      <VisualStateGroup>
        <VisualState>
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="610" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
          </VisualState.Setters>
        </VisualState>
        <VisualState>
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="0" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="HeaderLayout.Margin" Value="16 16" />
            <Setter Target="FoldersAdaptiveGridView.Padding" Value="8 16" />
            <Setter Target="FilesListView.Padding" Value="8 16" />
          </VisualState.Setters>
        </VisualState>
      </VisualStateGroup>
      
      <!-- ファイルの表示方法切り替え -->
      <VisualStateGroup>
        <VisualState>
          <VisualState.StateTriggers>
            <wst:EqualsStateTrigger Value="{Binding FileDisplayMode.Value}">
              <wst:EqualsStateTrigger.EqualTo>
                <models:FileDisplayMode>Small</models:FileDisplayMode>
              </wst:EqualsStateTrigger.EqualTo>
            </wst:EqualsStateTrigger>
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="FilesListView.ItemTemplateSelector" Value="{StaticResource SmallThumbnailFileItemTemplateSelector}" />
            <Setter Target="FilesListView.DesiredWidth" Value="{StaticResource SmallImageWidth}" />
            <Setter Target="FilesListView.ItemHeight" Value="{StaticResource SmallImageHeight}" />
          </VisualState.Setters>
        </VisualState>
        <VisualState>
          <VisualState.StateTriggers>
            <wst:EqualsStateTrigger Value="{Binding FileDisplayMode.Value}">
              <wst:EqualsStateTrigger.EqualTo>
                <models:FileDisplayMode>Midium</models:FileDisplayMode>
              </wst:EqualsStateTrigger.EqualTo>
            </wst:EqualsStateTrigger>
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="FilesListView.ItemTemplateSelector" Value="{StaticResource MidiumThumbnailFileItemTemplateSelector}" />
            <Setter Target="FilesListView.DesiredWidth" Value="{StaticResource MidiumImageWidth}" />
            <Setter Target="FilesListView.ItemHeight" Value="{StaticResource MidiumImageHeight}" />
          </VisualState.Setters>
        </VisualState>
        <VisualState>
          <VisualState.StateTriggers>
            <wst:EqualsStateTrigger Value="{Binding FileDisplayMode.Value}">
              <wst:EqualsStateTrigger.EqualTo>
                <models:FileDisplayMode>Large</models:FileDisplayMode>
              </wst:EqualsStateTrigger.EqualTo>
            </wst:EqualsStateTrigger>
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="FilesListView.ItemTemplateSelector" Value="{StaticResource LargeThumbnailFileItemTemplateSelector}" />
            <Setter Target="FilesListView.DesiredWidth" Value="{StaticResource LargeImageWidth}" />
            <Setter Target="FilesListView.ItemHeight" Value="{StaticResource LargeImageHeight}" />
          </VisualState.Setters>
        </VisualState>
      </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>
  </Grid>
</Page>
